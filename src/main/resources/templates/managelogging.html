<!doctype html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
	<!-- Required meta tags -->
	<!--公共部分所需css-->
	<div th:replace="~{component/public::head}"></div>
	<link href="/static/plugins/datatable/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
	<title>用户管理</title>
</head>

<body>
	<!--wrapper-->
	<div class="wrapper">
		<!--侧边栏-->
		<div th:replace="~{component/public::siderbar}">

		</div>
		<!--头部栏-->
		<div th:replace="~{component/public::top}"></div>
		<!--侧边设置换色-->
		<div th:replace="~{component/public::change-color}"></div>
		<div class="page-wrapper">
			<div class="page-content">





				<!--<div class="col">
					&lt;!&ndash; Button trigger modal &ndash;&gt;
					<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleScrollableModal">Scrollable Modal</button>
					&lt;!&ndash; Modal &ndash;&gt;
					<div class="modal fade" id="exampleScrollableModal" tabindex="-1" aria-hidden="true">
						<div class="modal-dialog modal-dialog-scrollable">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title">Modal title</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
									<p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
									<p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
									<p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
									<p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
									<p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
									<p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
									<p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
									<p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
									<p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
									<p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
									<p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
									<p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>
									<p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
									<p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
									<p>Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.</p>

									<p>Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.</p>
									<p>Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.</p>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
									<button type="button" class="btn btn-primary">Save changes</button>
								</div>
							</div>
						</div>
					</div>
				</div>-->


				<div style="display: flex;align-items: center">
					<h6 class="mb-0 text-uppercase" style="display: inline">用户列表</h6>
					<div class="ms-auto"  style="margin: 0 auto;" >
						<div class="btn-group" >
							<div class="col">
								<button id="queryAllButton" type="button" class="btn btn-dark px-5"><i class="bx bxs-box mr-1"></i>查询全部</button>
							</div>
						</div>
					</div>
				</div>
				<hr/>
				<div class="card">
					<div class="card-body">
						<div class="table-responsive">
							<table id="example" class="table table-striped table-bordered" style="width:100%;text-align: center">
								<thead>
								<tr>
									<th>时间</th>
									<th>信息</th>
									<th>错误等级</th>
									<th>线程名称</th>
									<th>查看详情</th>
								</tr>
								</thead>
								<tbody>
								<div class="modal fade" id="exampleScrollableModal" tabindex="-1" aria-hidden="true">
									<div class="modal-dialog modal-dialog-scrollable" style="max-width:70%;">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">日志详情</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											<div class="modal-body" id="detailcontext">
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
											</div>
										</div>
									</div>
								</div>
									<tr th:each="logging : ${loggings}">
										<td th:text="${logging.getLoggingTime()}"></td>
										<td style="max-width:400px;word-break: break-all;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;" th:text="${logging.getFormatted_message()}"></td>
										<td th:text="${logging.getLevel_string()}"></td>
										<td th:text="${logging.getThread_name()}"></td>
										<td th:if="${logging.getLevel_string()=='ERROR'}"><button th:data-id="${logging.getEvent_id()}" type="button" data-bs-toggle="modal" data-bs-target="#exampleScrollableModal" class="errorInfo btn btn-danger px-5 radius-30" style="background-color: #f41127;border-color: #f41127;border-radius: 5rem;">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle text-primary" style="color: #f8f8f8 !important;"><circle cx="12" cy="12" r="10"></circle>
												<line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>
											</svg>错误详情
										</button>
										</td>
										<td th:if="${logging.getLevel_string()!='ERROR'}"><button th:data-id="${logging.getEvent_id()}" type="button" data-bs-toggle="modal" data-bs-target="#exampleScrollableModal" class="detailInfo btn btn-success px-5" style="background-color: #17a00e;border-color: #17a00e;border-radius: 5rem;">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle text-primary" style="color:white !important;">
												<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
												<polyline points="22 4 12 14.01 9 11.01"></polyline>
											</svg>查看详情
										</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!--公共栏所需script-->
	<!--end wrapper-->

	<!--plugins-->
	<div th:replace="~{component/public::scripts}"></div>
	<script src="/static/plugins/simplebar/js/simplebar.min.js"></script>
	<script src="/static/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
	<script src="/static/plugins/datatable/js/jquery.dataTables.min.js"></script>
	<script src="/static/plugins/datatable/js/dataTables.bootstrap5.min.js"></script>
	<script>
		$(document).ready(function() {
			$("#queryAllButton").click(function (){
				var url = window.location.href;
				var param1 = '0'; // 假设这是您要传递的参数
				var form = $('<form></form>'); // 创建一个表单元素
				form.attr('method', 'POST'); // 设置表单提交方式为POST
				form.attr('action', url); // 设置表单提交的目标页面
				var input1 = $('<input></input>'); // 创建一个隐藏的input元素用来存储参数1
				input1.attr('type', 'hidden'); // 设置input元素的类型为隐藏
				input1.attr('name', 'flag'); // 设置input元素的name属性为param1
				input1.attr('value', param1); // 设置input元素的value属性为参数1的值
				form.append(input1); // 将input1添加到表单中
				form.appendTo('body'); // 将表单添加到页面中
				form.submit(); // 提交表单并跳转到目标页面
			});
			$('#example').DataTable();
			/*添加详细信息事件*/
			$("#example").on("click",".detailInfo",function () {

				const eventid =this.getAttribute("data-id");
				$.ajax({
					url:"/logging/detailInfo",
					method:"POST",
					async:false,
					data:{eventid:eventid},
					dataType: "json",
					success:function (res){
						console.log(eventid)
						if(res.status=='success'){
							$("#detailcontext").html(
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>loggingTime: "+res.event.loggingTime+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>caller_class: "+res.event.caller_class+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>caller_filename: "+res.event.caller_filename+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>caller_line: "+res.event.caller_line+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>caller_method: "+res.event.caller_method+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>event_id: "+res.event.event_id+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>formatted_message: "+res.event.formatted_message+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>level_string: "+res.event.level_string+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>logger_name: "+res.event.logger_name+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>reference_flag: "+res.event.reference_flag+"</p>"+
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>thread_name: "+res.event.thread_name+"</p>"
							)
						}else{
							$("#detailcontext").html("" +
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>获取信息失败</p>")
						}
					},
					error:function (err){
							$("#detailcontext").html("" +
								"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>获取信息失败</p>")
					}
				})
			})
			/*添加错误事件*/
			$("#example").on("click",".errorInfo",function (){
				const eventid =this.getAttribute("data-id");
				$.ajax({
					url:"/logging/errorInfo",
					method:"POST",
					async:false,
					data:{eventid:eventid},
					dataType:"json",
					success:function(res){
						if(res.status=='success'){
							var infos="";
							for(var i=0;i<res.loggingEventExceptions.length;i++){
								infos+="<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>i = "+res.loggingEventExceptions[i].i+"  trace_line: "+res.loggingEventExceptions[i].trace_line+"</p>"
							}
							$("#detailcontext").html(infos);
						}else{
							$("#detailcontext").html("" +
									"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>获取信息失败</p>")
						}
					},
					error:function (){
						$("#detailcontext").html("" +
								"<p style='word-break: break-all;white-space:pre-wrap;text-align:left;'>获取信息失败</p>")
					}
				})
			})
			});
	</script>
	<script>
		$(document).ready(function() {
			var table = $('#example2').DataTable( {
				lengthChange: false,
				buttons: [ 'copy', 'excel', 'pdf', 'print']
			} );
			table.buttons().container().appendTo( '#example2_wrapper .col-md-6:eq(0)');
		} );
	</script>

</body>

</html>